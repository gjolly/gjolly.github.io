<!doctype html><html>
<head>
<title>
Firewall, Tailscale and Ubuntu - Gauthier Jolly
</title>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=author content="Gauthier Jolly">
<link rel="shortcut icon" type=image/x-icon href=/img/terminal-sign.svg>
<link rel=stylesheet href=/style.min.39acacc5d2051426f655a6b7fbf4786fbd0fd8fffd09322c9b497ef0f7439b3f.css integrity="sha256-OaysxdIFFCb2Vaa3+/R4b70P2P/9CTIsm0l+8PdDmz8=">
<link rel=stylesheet href=/style-dark.min.0a647fb6c07e04b77b54fa0515d0a683d39ecdb251dba960fe1f966f7ff36fc2.css media="(prefers-color-scheme: dark)" integrity="sha256-CmR/tsB+BLd7VPoFFdCmg9OezbJR26lg/h+Wb3/zb8I=">
<link rel=stylesheet href=https://use.fontawesome.com/releases/v5.8.1/css/all.css integrity=sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf crossorigin=anonymous>
<link rel=stylesheet href=/css/custom.css>
<meta property="og:title" content="Firewall, Tailscale and Ubuntu">
<meta property="og:description" content="How to configure Ubuntu's Firewall to allow SSH in with Tailscale">
<meta property="og:type" content="article">
<meta property="og:url" content="/blog/ufw/"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2021-11-14T13:10:00+00:00">
<meta property="article:modified_time" content="2021-11-14T13:10:00+00:00">
<meta itemprop=name content="Firewall, Tailscale and Ubuntu">
<meta itemprop=description content="How to configure Ubuntu's Firewall to allow SSH in with Tailscale"><meta itemprop=datePublished content="2021-11-14T13:10:00+00:00">
<meta itemprop=dateModified content="2021-11-14T13:10:00+00:00">
<meta itemprop=wordCount content="316">
<meta itemprop=keywords content="Linux,Security,Ubuntu,"><meta name=twitter:card content="summary">
<meta name=twitter:image content="/img/avatar.jpg">
<meta name=twitter:title content="Firewall, Tailscale and Ubuntu">
<meta name=twitter:description content="How to configure Ubuntu's Firewall to allow SSH in with Tailscale"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]-->
</head>
<body>
<h1>Firewall, Tailscale and Ubuntu</h1>
<header>
<div class=avatar>
<img class=avatarMask src=/img/avatar.jpg alt>
<a href><img class=avatar-border src=/img/avatar-border.svg alt></a>
</div>
<h2><a class=author href>Gauthier Jolly</a></h2>
</header>
<p class=date>November 14, 2021</p>
<div id=tags>
<ul>
<li><a href=/tags/linux/>Linux</a></li>
<li><a href=/tags/security/>Security</a></li>
<li><a href=/tags/ubuntu/>Ubuntu</a></li>
</ul>
</div>
<div id=contentBody>
<h1 id=firewall-tailscale-and-ubuntu>Firewall, Tailscale and Ubuntu</h1>
<p>I recently enabled the Firewall on my desktop on Ubuntu. I probably did a quick lookup online to find out that <code>sudo ufw enable</code> was enough to enable it. I entered the command and forgot about it.</p>
<pre tabindex=0><code>$ sudo ufw enable
Firewall is active and enabled on system startup
</code></pre><p>Obviously, (and to be honest I was waiting for it), it didn&rsquo;t take long for things to go bad. A few weeks later, while I was not at home and wanted to SSH on my machine via <a href=https://tailscale.com/>tailscale</a>, I realized that I couldn&rsquo;t and quickly remember about the Firewall.</p>
<p>Quick side note here: I configured <code>sshd</code> to only bind to the tailscale IP address. I don&rsquo;t want to expose my desktop on the internet.</p>
<h2 id=uncomplicated-firewall>Uncomplicated FireWall</h2>
<p><a href=https://wiki.ubuntu.com/UncomplicatedFirewall><code>ufw</code></a> was introduced by Ubuntu to ease firewall configuration.</p>
<p>On Linux, &ldquo;Firewalling&rdquo; is usually done through the <a href=https://www.netfilter.org/>Netfilter subsystem</a> which can be configured via the userspace tool <a href=https://www.netfilter.org/projects/nftables/index.html>nftables</a> (successor of <a href=https://www.netfilter.org/projects/iptables/index.html>iptables</a>). Because <code>nftables</code> is made to be very generic and provides a full interface for the Netfilter subsystem, while being very powerfull it is not easy to learn.</p>
<p><code>ufw</code> is a simplified interface on top <code>nftables</code>. It helps the user to define simple Firewall rules.</p>
<p>This <a href=https://discourse.ubuntu.com/t/security-firewall/11883>blog post</a> describes basic use cases.</p>
<h2 id=allow-ssh-on-tailscale-only>Allow SSH on tailscale only</h2>
<p>A very cool feature of <code>ufw</code> is the notion of <code>app</code>. An <code>app</code> is defined by a config file stored in <code>/etc/ufw/applications.d</code>. Apps can be listed with <code>ufw app list</code>.</p>
<p>On my system I already had the <code>OpenSSH</code> app configured:</p>
<pre tabindex=0><code>$ cat /etc/ufw/applications.d/openssh-server
[OpenSSH]
title=Secure shell server, an rshd replacement
description=OpenSSH is a free implementation of the Secure Shell protocol.
ports=22/tcp
</code></pre><p>Indeed, on Ubuntu, this configuration file is shipped with the <code>openssh-server</code> package. Now to enable <code>OpenSSH</code> on tailscale for both IPv4 and IPv6, I can simply run:</p>
<pre tabindex=0><code>sudo ufw allow in on tailscale0 from any to any app OpenSSH
</code></pre>
</div>
<footer>
<p>
&copy; 2020 Gauthier Jolly.
Powered by <a href=https://gohugo.io/>Hugo</a>
using the <a href=https://github.com/koirand/pulp/>pulp</a> theme.
</p>
</footer>
</body>
</html>