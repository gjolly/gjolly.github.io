<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>FDE, Secureboot and unified kernel image | Gauthier Jolly</title>
<meta name=keywords content="Linux,Kernel,Boot,Ubuntu"><meta name=description content="Full Disk Encryption on most Linux distro has a major security flow. Why? How to fix it?"><meta name=author content="Gauthier Jolly"><link rel=canonical href=https://gjolly.fr/blog/unified_kernel_sb/><link crossorigin=anonymous href=https://gjolly.fr/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://gjolly.fr/img/terminal-sign.svg><link rel=icon type=image/png sizes=16x16 href=https://gjolly.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gjolly.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://gjolly.fr/apple-touch-icon.png><link rel=mask-icon href=https://gjolly.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gjolly.fr/blog/unified_kernel_sb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4G50Q2695"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y4G50Q2695")}</script><meta property="og:title" content="FDE, Secureboot and unified kernel image"><meta property="og:description" content="Full Disk Encryption on most Linux distro has a major security flow. Why? How to fix it?"><meta property="og:type" content="article"><meta property="og:url" content="https://gjolly.fr/blog/unified_kernel_sb/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-11-13T09:10:00+00:00"><meta property="article:modified_time" content="2022-11-13T09:10:00+00:00"><meta property="og:site_name" content="Gauthier Jolly"><meta name=twitter:card content="summary"><meta name=twitter:title content="FDE, Secureboot and unified kernel image"><meta name=twitter:description content="Full Disk Encryption on most Linux distro has a major security flow. Why? How to fix it?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://gjolly.fr/blog/"},{"@type":"ListItem","position":2,"name":"FDE, Secureboot and unified kernel image","item":"https://gjolly.fr/blog/unified_kernel_sb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"FDE, Secureboot and unified kernel image","name":"FDE, Secureboot and unified kernel image","description":"Full Disk Encryption on most Linux distro has a major security flow. Why? How to fix it?","keywords":["Linux","Kernel","Boot","Ubuntu"],"articleBody":"The flow In order to decrypt the root filesystem, the kernel uses a initial ram disk (initramfs). The initramfs provides an temporary filesystem from which extra kernel modules can be loaded, it also contains a set of scripts used to boot the system including scripts to decrypt the user’s root filesystem.\nThis initramfs image is a file stored un-encrypted next to the kernel image. However, unlike the kernel image, it is not signed by the kernel publisher as the iniramfs is generated locally and can be modified by the user. Thus, anyone with physical access to the user’s drive can inject a malicious initramfs that would log the user’s passphrase and thus make FDE useless.\nHow to fix it We can bundle the kernel and initramfs together in a single binary and sign this binary locally. Thus, modifying the initramfs would prevent the system from booting.\nIn practice On systems using mkinitcpio or dracut see this article: https://wiki.archlinux.org/title/Unified_kernel_image#Preparing_a_unified_kernel_image.\nOn Ubuntu To create the unified EFI binary:\nsudo add-apt-repository ppa:snappy-dev/image sudo apt-get -y install ubuntu-core-initramfs sudo ubuntu-core-initramfs create-efi --unsigned --output \"kernel.efi.unsigned\" \\ --cmdline \"$(cut -f 2- -d' ' /proc/cmdline)\" \\ --kernel \"/boot/vmlinuz\" \\ --kernelver \"$(uname -r)\" \\ --initrd \"/boot/initrd.img\" Create and enroll a new MOK:\n# You can let everything as default, or customize the fields, it doesn't matter openssl req -new -x509 -newkey rsa:2048 \\ -nodes -days 36500 -outform DER \\ -keyout \"MOK.priv\" \\ -out \"MOK.der\" openssl x509 -in MOK.der -inform DER -outform PEM -out MOK.pem sudo mokutil --import MOK.der Restart your system and follow the instructions to enroll the key.\nSign the Kernel EFI:\nsudo sbsign --key MOK.priv --cert MOK.pem kernel.efi.unsigned --output kernel.efi Move it do the ESP (or to the /boot partition), example:\nsudo mv kernel.efi /boot/efi/EFI/ubuntu Add a new boot entry to boot on this kernel, example (make sure to point change --disk and --part to your ESP):\nsudo efibootmgr --create --disk /dev/vda --part 15 --label \"Ubuntu $(uname -r)\" --loader \"\\EFI\\ubuntu\\shimx64.efi\" -u \"\\EFI\\ubuntu\\kernel.efi\" Next To make it persistent:\nMake the kernel hook for ubuntu-core-initramfs use your keys:\nsudo mkdir /etc/custom-mok/ sudo mv MOK.priv MOK.pem /etc/custom-mok/ and modify the hook itself at /etc/kernel/postinst.d/ubuntu-core-initramfs:\nubuntu-core-initramfs create-efi --key /etc/custom-mok/MOK.priv --cert /etc/custom-mok/MOK.pem --kernelver $version create two new hooks:\ncat /etc/kernel/postinst.d/zz-update-efi-boot #!/bin/sh set -e version=\"$1\" command -v efibootmgr \u003e/dev/null 2\u003e\u00261 || exit 0 part_dev=\"$(blkid | grep 'LABEL_FATBOOT=\"UEFI\"' | cut -f1 -d':')\" disk=\"/dev/$(lsblk -ndo pkname ${part_dev})\" part_name=${part_dev##/dev/} part_num=\"$(cat /sys/class/block/${part_name}/partition)\" # Let's not duplicate the entry if it already exist efibootmgr | grep -q \"$version\" \u0026\u0026 exit 0 echo \"adding new EFI boot entry\" efibootmgr -q --create --disk \"$disk\" --part \"$part_num\" --label \"Ubuntu $version\" --loader \"\\EFI\\ubuntu\\shimx64.efi\" -u \"\\EFI\\ubuntu\\kernel.efi-$version\" cat /etc/kernel/postrm.d/zz-update-efi-boot #!/bin/sh set -e version=\"$1\" command -v efibootmgr \u003e/dev/null 2\u003e\u00261 || exit 0 BOOT_NUM=$(efibootmgr | grep \"$version\" | cut -f1 -d'*' | sed 's/Boot\\(.*\\)/\\1/') if [ -f \"$BOOT_NUM\" ]; then exit 0 fi efibootmgr -q -b \"$BOOT_NUM\" -B and make sure it they are executable.\n","wordCount":"480","inLanguage":"en","datePublished":"2022-11-13T09:10:00Z","dateModified":"2022-11-13T09:10:00Z","author":{"@type":"Person","name":"Gauthier Jolly"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gjolly.fr/blog/unified_kernel_sb/"},"publisher":{"@type":"Organization","name":"Gauthier Jolly","logo":{"@type":"ImageObject","url":"https://gjolly.fr/img/terminal-sign.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gjolly.fr/ accesskey=h title="Home (Alt + H)"><img src=https://gjolly.fr/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gjolly.fr/blog/ title=blog><span>blog</span></a></li><li><a href=https://gjolly.fr/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gjolly.fr/>Home</a>&nbsp;»&nbsp;<a href=https://gjolly.fr/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">FDE, Secureboot and unified kernel image</h1><div class=post-description>Full Disk Encryption on most Linux distro has a major security flow. Why? How to fix it?</div><div class=post-meta><span title='2022-11-13 09:10:00 +0000 UTC'>November 13, 2022</span>&nbsp;·&nbsp;480 words&nbsp;·&nbsp;Gauthier Jolly</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#the-flow>The flow</a></li><li><a href=#how-to-fix-it>How to fix it</a></li><li><a href=#in-practice>In practice</a><ul><li><a href=#on-ubuntu>On Ubuntu</a></li></ul></li><li><a href=#next>Next</a></li></ul></nav></div></details></div><div class=post-content><h2 id=the-flow>The flow<a hidden class=anchor aria-hidden=true href=#the-flow>#</a></h2><p>In order to decrypt the root filesystem, the kernel uses a initial ram disk (initramfs). The initramfs provides an temporary filesystem from which extra kernel modules can be loaded, it also contains a set of scripts used to boot the system including scripts to decrypt the user&rsquo;s root filesystem.</p><p>This initramfs image is a file stored un-encrypted next to the kernel image. However, unlike the kernel image, it is not signed by the kernel publisher as the iniramfs is generated locally and can be modified by the user. Thus, anyone with physical access to the user&rsquo;s drive can inject a malicious initramfs that would log the user&rsquo;s passphrase and thus make FDE useless.</p><h2 id=how-to-fix-it>How to fix it<a hidden class=anchor aria-hidden=true href=#how-to-fix-it>#</a></h2><p>We can bundle the kernel and initramfs together in a single binary and sign this binary locally. Thus, modifying the initramfs would prevent the system from booting.</p><h2 id=in-practice>In practice<a hidden class=anchor aria-hidden=true href=#in-practice>#</a></h2><p>On systems using <code>mkinitcpio</code> or <code>dracut</code> see this article: <a href=https://wiki.archlinux.org/title/Unified_kernel_image#Preparing_a_unified_kernel_image>https://wiki.archlinux.org/title/Unified_kernel_image#Preparing_a_unified_kernel_image</a>.</p><h3 id=on-ubuntu>On Ubuntu<a hidden class=anchor aria-hidden=true href=#on-ubuntu>#</a></h3><p>To create the unified EFI binary:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo add-apt-repository ppa:snappy-dev/image
</span></span><span class=line><span class=cl>sudo apt-get -y install ubuntu-core-initramfs
</span></span><span class=line><span class=cl>sudo ubuntu-core-initramfs create-efi --unsigned --output <span class=s2>&#34;kernel.efi.unsigned&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --cmdline <span class=s2>&#34;</span><span class=k>$(</span>cut -f 2- -d<span class=s1>&#39; &#39;</span> /proc/cmdline<span class=k>)</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --kernel <span class=s2>&#34;/boot/vmlinuz&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --kernelver <span class=s2>&#34;</span><span class=k>$(</span>uname -r<span class=k>)</span><span class=s2>&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        --initrd <span class=s2>&#34;/boot/initrd.img&#34;</span>
</span></span></code></pre></div><p>Create and enroll a new MOK:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># You can let everything as default, or customize the fields, it doesn&#39;t matter</span>
</span></span><span class=line><span class=cl>openssl req -new -x509 -newkey rsa:2048 <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -nodes -days <span class=m>36500</span> -outform DER <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -keyout <span class=s2>&#34;MOK.priv&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        -out <span class=s2>&#34;MOK.der&#34;</span>
</span></span><span class=line><span class=cl>openssl x509 -in MOK.der -inform DER -outform PEM -out MOK.pem
</span></span><span class=line><span class=cl>sudo mokutil --import MOK.der
</span></span></code></pre></div><p>Restart your system and follow the instructions to enroll the key.</p><p>Sign the Kernel EFI:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo sbsign --key MOK.priv --cert MOK.pem kernel.efi.unsigned --output kernel.efi
</span></span></code></pre></div><p>Move it do the ESP (or to the /boot partition), example:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mv kernel.efi /boot/efi/EFI/ubuntu
</span></span></code></pre></div><p>Add a new boot entry to boot on this kernel, example (make sure to point change <code>--disk</code> and <code>--part</code> to your ESP):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo efibootmgr --create --disk /dev/vda --part <span class=m>15</span> --label <span class=s2>&#34;Ubuntu </span><span class=k>$(</span>uname -r<span class=k>)</span><span class=s2>&#34;</span> --loader <span class=s2>&#34;\EFI\ubuntu\shimx64.efi&#34;</span> -u <span class=s2>&#34;\EFI\ubuntu\kernel.efi&#34;</span>
</span></span></code></pre></div><h2 id=next>Next<a hidden class=anchor aria-hidden=true href=#next>#</a></h2><p>To make it persistent:</p><p>Make the kernel hook for <code>ubuntu-core-initramfs</code> use your keys:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mkdir /etc/custom-mok/
</span></span><span class=line><span class=cl>sudo mv MOK.priv MOK.pem /etc/custom-mok/
</span></span></code></pre></div><p>and modify the hook itself at <code>/etc/kernel/postinst.d/ubuntu-core-initramfs</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ubuntu-core-initramfs create-efi --key /etc/custom-mok/MOK.priv --cert /etc/custom-mok/MOK.pem --kernelver <span class=nv>$version</span>
</span></span></code></pre></div><p>create two new hooks:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/kernel/postinst.d/zz-update-efi-boot
</span></span><span class=line><span class=cl><span class=c1>#!/bin/sh</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>version</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>command</span> -v efibootmgr &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>||</span> <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>part_dev</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>blkid <span class=p>|</span> grep <span class=s1>&#39;LABEL_FATBOOT=&#34;UEFI&#34;&#39;</span> <span class=p>|</span> cut -f1 -d<span class=s1>&#39;:&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>disk</span><span class=o>=</span><span class=s2>&#34;/dev/</span><span class=k>$(</span>lsblk -ndo pkname <span class=si>${</span><span class=nv>part_dev</span><span class=si>}</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>part_name</span><span class=o>=</span><span class=si>${</span><span class=nv>part_dev</span><span class=p>##/dev/</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=nv>part_num</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>cat /sys/class/block/<span class=si>${</span><span class=nv>part_name</span><span class=si>}</span>/partition<span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Let&#39;s not duplicate the entry if it already exist</span>
</span></span><span class=line><span class=cl>efibootmgr <span class=p>|</span> grep -q <span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span> <span class=o>&amp;&amp;</span> <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;adding new EFI boot entry&#34;</span>
</span></span><span class=line><span class=cl>efibootmgr -q --create --disk <span class=s2>&#34;</span><span class=nv>$disk</span><span class=s2>&#34;</span> --part <span class=s2>&#34;</span><span class=nv>$part_num</span><span class=s2>&#34;</span> --label <span class=s2>&#34;Ubuntu </span><span class=nv>$version</span><span class=s2>&#34;</span> --loader <span class=s2>&#34;\EFI\ubuntu\shimx64.efi&#34;</span> -u <span class=s2>&#34;\EFI\ubuntu\kernel.efi-</span><span class=nv>$version</span><span class=s2>&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /etc/kernel/postrm.d/zz-update-efi-boot
</span></span><span class=line><span class=cl><span class=c1>#!/bin/sh</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>version</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>command</span> -v efibootmgr &gt;/dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=o>||</span> <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>BOOT_NUM</span><span class=o>=</span><span class=k>$(</span>efibootmgr <span class=p>|</span> grep <span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span> <span class=p>|</span> cut -f1 -d<span class=s1>&#39;*&#39;</span> <span class=p>|</span> sed <span class=s1>&#39;s/Boot\(.*\)/\1/&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> -f <span class=s2>&#34;</span><span class=nv>$BOOT_NUM</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>efibootmgr -q -b <span class=s2>&#34;</span><span class=nv>$BOOT_NUM</span><span class=s2>&#34;</span> -B
</span></span></code></pre></div><p>and make sure it they are executable.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://gjolly.fr/tags/linux/>Linux</a></li><li><a href=https://gjolly.fr/tags/kernel/>Kernel</a></li><li><a href=https://gjolly.fr/tags/boot/>Boot</a></li><li><a href=https://gjolly.fr/tags/ubuntu/>Ubuntu</a></li></ul><nav class=paginav><a class=prev href=https://gjolly.fr/blog/boot-from-rom/><span class=title>« Prev</span><br><span>Boot Linux with coreboot without bootloader</span>
</a><a class=next href=https://gjolly.fr/blog/grub_less/><span class=title>Next »</span><br><span>Boot Linux without GRUB</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://gjolly.fr/>Gauthier Jolly</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>