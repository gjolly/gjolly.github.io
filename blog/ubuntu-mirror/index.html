<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How I built an Ubuntu archive mirror using Cloudflare | Gauthier Jolly</title><meta name=keywords content="Debian,Ubuntu,Cloudflare"><meta name=description content="A fast and modern way to create an package mirror."><meta name=author content="Gauthier Jolly"><link rel=canonical href=https://gjolly.fr/blog/ubuntu-mirror/><link crossorigin=anonymous href=https://gjolly.fr/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://gjolly.fr/img/terminal-sign.svg><link rel=icon type=image/png sizes=16x16 href=https://gjolly.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gjolly.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://gjolly.fr/apple-touch-icon.png><link rel=mask-icon href=https://gjolly.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://gjolly.fr/blog/ubuntu-mirror/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4G50Q2695"></script><script>var doNotTrack=!1,dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes";if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y4G50Q2695")}</script><meta property="og:url" content="https://gjolly.fr/blog/ubuntu-mirror/"><meta property="og:site_name" content="Gauthier Jolly"><meta property="og:title" content="How I built an Ubuntu archive mirror using Cloudflare"><meta property="og:description" content="A fast and modern way to create an package mirror."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2025-09-25T11:30:00+01:00"><meta property="article:modified_time" content="2025-09-25T11:30:00+01:00"><meta property="article:tag" content="Debian"><meta property="article:tag" content="Ubuntu"><meta property="article:tag" content="Cloudflare"><meta name=twitter:card content="summary"><meta name=twitter:title content="How I built an Ubuntu archive mirror using Cloudflare"><meta name=twitter:description content="A fast and modern way to create an package mirror."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Blogs","item":"https://gjolly.fr/blog/"},{"@type":"ListItem","position":2,"name":"How I built an Ubuntu archive mirror using Cloudflare","item":"https://gjolly.fr/blog/ubuntu-mirror/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How I built an Ubuntu archive mirror using Cloudflare","name":"How I built an Ubuntu archive mirror using Cloudflare","description":"A fast and modern way to create an package mirror.","keywords":["Debian","Ubuntu","Cloudflare"],"articleBody":"For a while, I wanted to set up an Ubuntu archive mirror using Cloudflare. It felt like a natural idea: the archive is a set of static files that could be easily cached, and Cloudflare is very good at caching files close to users around the world.\nWhat is an archive mirror? If you have ever run apt update on Ubuntu, you have used the archive. It is a big collection of files: packages (.deb files) and index files (Packages.gz, Release, etc.) that tell apt what is available.\nThe structure was designed more than 20 years ago, before CDNs and large-scale caching were common. It is very stable, but not optimized for today’s internet.\nIf you want to see how it looks, you can browse archive.ubuntu.com or read about the Debian repository format.\nMy first idea: the “big sync” My first plan was to copy the entire archive into Cloudflare R2, their low-cost object store. I thought I would write workers to parse the index files, detect changes, and keep R2 in sync with the upstream archive.\nBut this was heavy: the archive is very large, the initial storage without being too high would not be null and the code to make sure that the indices would stay in sync with what was available in the mirror would not be trivial. Indeed, if a index reference a package which has not been synced, it would cause the client to fail. All of that for a mirror that maybe only a few people would use.\nWhat I ended up doing: “lazy syncing” Instead, I settled on something much simpler.\nWhen a client asks for a package file, my worker fetches it from the upstream archive, stores it in R2, and caches it in Cloudflare’s edge for 1 day. Index files are not stored in R2. They are just cached in Cloudflare for 30 minutes. This way, I do not need to preload or parse the whole archive. Packages appear only if someone asks for them.\nOne of the drawback here is that every request hits the worker which add more cost but I figured that if it would become a problem later on, I could switch to my original idea..\nPutting it in production Mirror URL: https://ubuntu.gjolly.dev/ubuntu\nAs you might expect, getting this to production was not without issues.\nAt first, I made a mistake with a symlink that pointed /ubuntu back to itself. Yes, a recursive path! You can try it by yourself: http://archive.ubuntu.com/ubuntu/ubuntu/ubuntu/ubuntu, you can add as many ubuntu as you wish, it will always work because on the actual filesystem ubuntu/ubuntu is a symlink to itself! On a static file server, it might work with no problem but I certainly didn’t want my object store to be filled with duplicated data.\nMy next “oops” moment was when I submitted the mirror to the official Ubuntu archive mirrors list, to my surprise, the probes all failed. Indeed, I had completely forgot to support HEAD requests\nRunning the numbers Let’s take a random package of the archive: mysql and try to download it from the upstream archive maintained by Canonical, from my regional mirror and from my service:\n$ curl -o /dev/null https://archive.ubuntu.com/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2083k 100 2083k 0 0 7569k 0 --:--:-- --:--:-- --:--:-- 7576k $ curl -o /dev/null https://fr.archive.ubuntu.com/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2083k 100 2083k 0 0 5895k 0 --:--:-- --:--:-- --:--:-- 5885k $ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2083k 100 2083k 0 0 1510k 0 0:00:01 0:00:01 --:--:-- 1510k As you can see (average Dload) my service is the worse, but wait! Let’s try again now:\n$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2083k 100 2083k 0 0 14.0M 0 --:--:-- --:--:-- --:--:-- 14.1M Yay! Now that it’s in the cache, we are twice as fast as the official archive.\nLet’s do that but with a bigger package, for example linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb which is 114MB big:\n$ curl -o /dev/null https://archive.ubuntu.com/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 113M 100 113M 0 0 29.2M 0 0:00:03 0:00:03 --:--:-- 29.2M $ curl -o /dev/null https://fr.archive.ubuntu.com/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 113M 100 113M 0 0 2294k 0 0:00:50 0:00:50 --:--:-- 5368k $ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 113M 100 113M 0 0 84.1M 0 0:00:01 0:00:01 --:--:-- 84.1M But once again, after caching we get 134 MB/s\n$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 113M 100 113M 0 0 134M 0 --:--:-- --:--:-- --:--:-- 134M Why this design makes sense This approach only works well if more than one person uses the mirror in each Cloudflare edge location. If I am the only one hitting it, then most requests will go all the way back to the upstream archive. But if many users share the same edge cache, the benefit grows quickly: new packages are quickly added to the R2 bucket and stay cached on the edge, downloads become much faster: only the first client has to pay a “high” latency\nSo, if you want to try it, please do! It’s available at https://ubuntu.gjolly.dev/ubuntu. The more people use it, the better it works.\n","wordCount":"973","inLanguage":"en","datePublished":"2025-09-25T11:30:00+01:00","dateModified":"2025-09-25T11:30:00+01:00","author":{"@type":"Person","name":"Gauthier Jolly"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gjolly.fr/blog/ubuntu-mirror/"},"publisher":{"@type":"Organization","name":"Gauthier Jolly","logo":{"@type":"ImageObject","url":"https://gjolly.fr/img/terminal-sign.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gjolly.fr/ accesskey=h title="Home (Alt + H)"><img src=https://gjolly.fr/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gjolly.fr/blog/ title=blog><span>blog</span></a></li><li><a href=https://gjolly.fr/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gjolly.fr/>Home</a>&nbsp;»&nbsp;<a href=https://gjolly.fr/blog/>Blogs</a></div><h1 class="post-title entry-hint-parent">How I built an Ubuntu archive mirror using Cloudflare</h1><div class=post-description>A fast and modern way to create an package mirror.</div><div class=post-meta><span title='2025-09-25 11:30:00 +0100 +0100'>September 25, 2025</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Gauthier Jolly</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#what-is-an-archive-mirror>What is an archive mirror?</a></li><li><a href=#my-first-idea-the-big-sync>My first idea: the “big sync”</a></li><li><a href=#what-i-ended-up-doing-lazy-syncing>What I ended up doing: “lazy syncing”</a></li><li><a href=#putting-it-in-production>Putting it in production</a></li></ul><ul><li><a href=#why-this-design-makes-sense>Why this design makes sense</a></li></ul></nav></div></details></div><div class=post-content><p>For a while, I wanted to set up an Ubuntu archive mirror using Cloudflare. It felt like a natural idea: the archive is a set of static files that could be easily cached, and Cloudflare is very good at caching files close to users around the world.</p><hr><h2 id=what-is-an-archive-mirror>What is an archive mirror?<a hidden class=anchor aria-hidden=true href=#what-is-an-archive-mirror>#</a></h2><p>If you have ever run <code>apt update</code> on Ubuntu, you have used the archive. It is a big collection of files: packages (<code>.deb</code> files) and index files (<code>Packages.gz</code>, <code>Release</code>, etc.) that tell <code>apt</code> what is available.</p><p>The structure was designed more than 20 years ago, before CDNs and large-scale caching were common. It is very stable, but not optimized for today’s internet.</p><p>If you want to see how it looks, you can browse <a href=http://archive.ubuntu.com>archive.ubuntu.com</a> or read about the <a href=https://wiki.debian.org/DebianRepository/Format>Debian repository format</a>.</p><hr><h2 id=my-first-idea-the-big-sync>My first idea: the “big sync”<a hidden class=anchor aria-hidden=true href=#my-first-idea-the-big-sync>#</a></h2><p>My first plan was to copy the entire archive into <strong>Cloudflare R2</strong>, their low-cost object store. I thought I would write workers to parse the index files, detect changes, and keep R2 in sync with the upstream archive.</p><p>But this was heavy: the archive is very large, the initial storage without being too high would not be null and the code to make sure that the indices would stay in sync with what was available in the mirror would not be trivial. Indeed, if a index reference a package which has not been synced, it would cause the client to fail. All of that for a mirror that maybe only a few people would use.</p><hr><h2 id=what-i-ended-up-doing-lazy-syncing>What I ended up doing: “lazy syncing”<a hidden class=anchor aria-hidden=true href=#what-i-ended-up-doing-lazy-syncing>#</a></h2><p>Instead, I settled on something much simpler.</p><ul><li>When a client asks for a package file, my worker fetches it from the upstream archive, stores it in R2, and caches it in Cloudflare’s edge for 1 day.</li><li>Index files are <strong>not stored in R2</strong>. They are just cached in Cloudflare for 30 minutes.</li></ul><p>This way, I do not need to preload or parse the whole archive. Packages appear only if someone asks for them.</p><p>One of the drawback here is that every request hits the worker which add more cost but I figured that if it would become a problem later on, I could switch to my original idea..</p><hr><h2 id=putting-it-in-production>Putting it in production<a hidden class=anchor aria-hidden=true href=#putting-it-in-production>#</a></h2><p>Mirror URL: <a href=https://ubuntu.gjolly.dev/ubuntu>https://ubuntu.gjolly.dev/ubuntu</a></p><p>As you might expect, getting this to production was not without issues.</p><p>At first, I made a mistake with a symlink that pointed <code>/ubuntu</code> back to itself. Yes, a recursive path! You can try it by yourself: <a href=http://archive.ubuntu.com/ubuntu/ubuntu/ubuntu/ubuntu>http://archive.ubuntu.com/ubuntu/ubuntu/ubuntu/ubuntu</a>, you can add as many <code>ubuntu</code> as you wish, it will always work because on the actual filesystem <code>ubuntu/ubuntu</code> is a symlink to itself! On a static file server, it might work with no problem but I certainly didn&rsquo;t want my object store to be filled with duplicated data.</p><p>My next &ldquo;oops&rdquo; moment was when I submitted the mirror to the official <a href=https://launchpad.net/ubuntu/+archivemirrors>Ubuntu archive mirrors list</a>, to my surprise, the probes all failed. Indeed, I had completely forgot to support <strong>HEAD</strong> requests</p><hr><h1 id=running-the-numbers>Running the numbers<a hidden class=anchor aria-hidden=true href=#running-the-numbers>#</a></h1><p>Let&rsquo;s take a random package of the archive: <code>mysql</code> and try to download it from the upstream archive maintained by Canonical, from my regional mirror and from my service:</p><pre tabindex=0><code>$ curl -o /dev/null https://archive.ubuntu.com/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2083k  100 2083k    0     0  7569k      0 --:--:-- --:--:-- --:--:-- 7576k
$ curl -o /dev/null https://fr.archive.ubuntu.com/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2083k  100 2083k    0     0  5895k      0 --:--:-- --:--:-- --:--:-- 5885k
$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2083k  100 2083k    0     0  1510k      0  0:00:01  0:00:01 --:--:-- 1510k
</code></pre><p>As you can see (<code>average Dload</code>) my service is the worse, but wait! Let&rsquo;s try again now:</p><pre tabindex=0><code>$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/m/mysql-8.4/mysql-client-core_8.4.6-0ubuntu0.25.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 2083k  100 2083k    0     0  14.0M      0 --:--:-- --:--:-- --:--:-- 14.1M
</code></pre><p>Yay! Now that it&rsquo;s in the cache, we are twice as fast as the official archive.</p><p>Let&rsquo;s do that but with a bigger package, for example <code>linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb</code> which is <code>114MB</code> big:</p><pre tabindex=0><code>$ curl -o /dev/null https://archive.ubuntu.com/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  113M  100  113M    0     0  29.2M      0  0:00:03  0:00:03 --:--:-- 29.2M
$ curl -o /dev/null https://fr.archive.ubuntu.com/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  113M  100  113M    0     0  2294k      0  0:00:50  0:00:50 --:--:-- 5368k
$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  113M  100  113M    0     0  84.1M      0  0:00:01  0:00:01 --:--:-- 84.1M
</code></pre><p>But once again, after caching we get <code>134 MB/s</code></p><pre tabindex=0><code>$ curl -o /dev/null https://ubuntu.gjolly.dev/ubuntu/pool/main/l/linux-hwe-6.14/linux-modules-extra-6.14.0-22-generic_6.14.0-22.22~24.04.1_amd64.deb
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  113M  100  113M    0     0   134M      0 --:--:-- --:--:-- --:--:--  134M
</code></pre><hr><h2 id=why-this-design-makes-sense>Why this design makes sense<a hidden class=anchor aria-hidden=true href=#why-this-design-makes-sense>#</a></h2><p>This approach only works well if more than one person uses the mirror in each Cloudflare edge location. If I am the only one hitting it, then most requests will go all the way back to the upstream archive. But if many users share the same edge cache, the benefit grows quickly: new packages are quickly added to the R2 bucket and stay cached on the edge, downloads become much faster: only the first client has to pay a &ldquo;high&rdquo; latency</p><p>So, if you want to try it, please do! It&rsquo;s available at <a href=https://ubuntu.gjolly.dev/ubuntu>https://ubuntu.gjolly.dev/ubuntu</a>. The more people use it, the better it works.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://gjolly.fr/tags/debian/>Debian</a></li><li><a href=https://gjolly.fr/tags/ubuntu/>Ubuntu</a></li><li><a href=https://gjolly.fr/tags/cloudflare/>Cloudflare</a></li></ul><nav class=paginav><a class=prev href=https://gjolly.fr/blog/ubuntu-desktop-images/><span class=title>« Prev</span><br><span>Build an Ubuntu Destkop image with genesis</span>
</a><a class=next href=https://gjolly.fr/blog/linux-system-boot/><span class=title>Next »</span><br><span>Architecture of a Linux system and boot process</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://gjolly.fr/>Gauthier Jolly</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>