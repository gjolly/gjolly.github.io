<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Linux | Gauthier Jolly</title>
<meta name=keywords content><meta name=description content="Personal website of Gauthier Jolly"><meta name=author content="Gauthier Jolly"><link rel=canonical href=https://gjolly.fr/tags/linux/><link crossorigin=anonymous href=https://gjolly.fr/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://gjolly.fr/img/terminal-sign.svg><link rel=icon type=image/png sizes=16x16 href=https://gjolly.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gjolly.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://gjolly.fr/apple-touch-icon.png><link rel=mask-icon href=https://gjolly.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://gjolly.fr/tags/linux/index.xml><link rel=alternate hreflang=en href=https://gjolly.fr/tags/linux/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4G50Q2695"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y4G50Q2695")}</script><meta property="og:url" content="https://gjolly.fr/tags/linux/"><meta property="og:site_name" content="Gauthier Jolly"><meta property="og:title" content="Linux"><meta property="og:description" content="Personal website of Gauthier Jolly"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta name=twitter:card content="summary"><meta name=twitter:title content="Linux"><meta name=twitter:description content="Personal website of Gauthier Jolly"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gjolly.fr/ accesskey=h title="Home (Alt + H)"><img src=https://gjolly.fr/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://gjolly.fr/blog/ title=blog><span>blog</span></a></li><li><a href=https://gjolly.fr/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://gjolly.fr/>Home</a>&nbsp;»&nbsp;<a href=https://gjolly.fr/tags/>Tags</a></div><h1>Linux
<a href=https://gjolly.fr/tags/linux/index.xml title=RSS aria-label=RSS><svg viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Build an Ubuntu Server live image with mkosi</h2></header><div class=entry-content><p>Basic Config [Distribution] Distribution=ubuntu [Output] Format=disk [Content] Packages= apt cloud-init dbus grub-efi-amd64-signed iproute2 linux-virtual netplan.io openssh-server openssl shim-signed ssh-import-id sudo systemd systemd-resolved udev vim Bootloader=grub ShimBootloader=signed BiosBootloader=none Bootable=true RootPassword=ubuntu KernelCommandLine=console=ttyS0 Hostname=ubuntu Then simply run mkosi.
Boot the image Use this script (use –no-snapshot to make the changes persist):
./start-vm.sh ./image.raw To go further At the moment, mkosi only supports producing raw disk images. To convert the image to qcow2:
qemu-img convert -f raw -O qcow2 /tmp/image.raw /tmp/ubuntu.img And to make it (virtually) bigger:
...</p></div><footer class=entry-footer><span title='2024-12-22 12:10:00 +0000 UTC'>December 22, 2024</span>&nbsp;·&nbsp;87 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to Build an Ubuntu Server live image with mkosi" href=https://gjolly.fr/blog/ubuntu-mkosi/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Boot Linux with coreboot without bootloader</h2></header><div class=entry-content><p>Boot process - context In general, the boot process looks like this:
ROM | DISK Pre-EFI initialization -> EFI firwmare -|> shim -> grub -> Linux The pre-efi initialization is about initializing CPU and devices. Especially, it is responsible for initializing the DRAM controller on the CPU. Before this step the system is in a very precurious state and can only use its cache as memory (aka Cache as RAM).
...</p></div><footer class=entry-footer><span title='2024-10-14 17:10:00 +0000 UTC'>October 14, 2024</span>&nbsp;·&nbsp;321 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to Boot Linux with coreboot without bootloader" href=https://gjolly.fr/blog/boot-from-rom/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>User temporary directory</h2></header><div class=entry-content><p>systemd-tmpfiles /tmp and other temporary directories and files are now managed by systemd and are not tmpfs. sytemd-tmpfiles gives to the user the ability to choose what they want to do with temporary directories/files. There are a ton of options that the user can choose from and everything is managed though config files (see man tmpfiles.d).
Create a temporary directory in your HOME folder Using the global /tmp directory can be security issue as anyone can read this directory. If the user is not very carefull with the permissions they set on their files, confidential information might leak. Also, programs packaged with snap cannot access the global temporary directory /tmp by default.
...</p></div><footer class=entry-footer><span title='2023-08-07 11:10:00 +0000 UTC'>August 7, 2023</span>&nbsp;·&nbsp;230 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to User temporary directory" href=https://gjolly.fr/blog/user_tmp/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>A basic CLI tool to build Ubuntu images</h2></header><div class=entry-content><p>Genesis a CLI project written in Python. It can build Ubuntu images from scratch.
The tool is named genesis (because you start from nothing). And is available as a python package: https://github.com/gjolly/genesis (it’s also packaged as a deb in a PPA.
A basic example We are going to create a very minimal image of Ubuntu 23.04 (Lunar Lobster) and try to boot from it using qemu.
Creating a base image First you want to start by bootstrapping a basic filesystem:
...</p></div><footer class=entry-footer><span title='2023-06-09 09:10:00 +0000 UTC'>June 9, 2023</span>&nbsp;·&nbsp;635 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to A basic CLI tool to build Ubuntu images" href=https://gjolly.fr/blog/genesis/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>FDE, Secureboot and unified kernel image</h2></header><div class=entry-content><p>The flow In order to decrypt the root filesystem, the kernel uses a initial ram disk (initramfs). The initramfs provides an temporary filesystem from which extra kernel modules can be loaded, it also contains a set of scripts used to boot the system including scripts to decrypt the user’s root filesystem.
This initramfs image is a file stored un-encrypted next to the kernel image. However, unlike the kernel image, it is not signed by the kernel publisher as the iniramfs is generated locally and can be modified by the user. Thus, anyone with physical access to the user’s drive can inject a malicious initramfs that would log the user’s passphrase and thus make FDE useless.
...</p></div><footer class=entry-footer><span title='2022-11-13 09:10:00 +0000 UTC'>November 13, 2022</span>&nbsp;·&nbsp;480 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to FDE, Secureboot and unified kernel image" href=https://gjolly.fr/blog/unified_kernel_sb/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Boot Linux without GRUB</h2></header><div class=entry-content><p>To boot the Linux Kernel, most distro use a bootloader and one of the most popular is GRUB. But did you know you can directly boot the Kernel without using a bootloader?
DISCLAIMER: This is only for fun and learning, I do not advise anyone to do that on their main system. Be safe, use a VM.
VM setup Just a quick recap of what is needed (mostely stolen from powersj’s excelent blog post).
...</p></div><footer class=entry-footer><span title='2021-11-19 11:10:00 +0000 UTC'>November 19, 2021</span>&nbsp;·&nbsp;651 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to Boot Linux without GRUB" href=https://gjolly.fr/blog/grub_less/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>QEMU cheatsheet</h2></header><div class=entry-content><p>The basics https://powersj.io/posts/ubuntu-qemu-cli/
Mount disk images It is ofter very convenient to mount a FS locally to be able to debug and/or fix a problem with a broken disk.
Pre-requisite to everything: mkdir /tmp/rootfs
To know the format of your disk: qemu-img info disk.img (note that qemu-img can output JSON to automate your stuff)
Raw disk images losetup -f -P disk.img losetup -l | grep -v snap # to find the loop device you just created and yeah those snaps.... mount /dev/loopXpX /tmp/rootfs For anything else (QCOW2, VHD/VPC, etc…) modprobe nbd qemu-nbd --connect=/dev/nbd0 disk.img fdisk /dev/nbd0 -l # to find your partition mount /dev/nbd0pX /tmp/rootfs</p></div><footer class=entry-footer><span title='2021-11-19 11:10:00 +0000 UTC'>November 19, 2021</span>&nbsp;·&nbsp;105 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to QEMU cheatsheet" href=https://gjolly.fr/blog/qemu_cheatsheet/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>Firewall, Tailscale and Ubuntu</h2></header><div class=entry-content><p>I recently enabled the Firewall on my desktop on Ubuntu. I probably did a quick lookup online to find out that sudo ufw enable was enough to enable it. I entered the command and forgot about it.
$ sudo ufw enable Firewall is active and enabled on system startup Obviously, (and to be honest I was waiting for it), it didn’t take long for things to go bad. A few weeks later, while I was not at home and wanted to SSH on my machine via tailscale, I realized that I couldn’t and quickly remember about the Firewall.
...</p></div><footer class=entry-footer><span title='2021-11-14 13:10:00 +0000 UTC'>November 14, 2021</span>&nbsp;·&nbsp;312 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to Firewall, Tailscale and Ubuntu" href=https://gjolly.fr/blog/ufw/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2 class=entry-hint-parent>The UNIX `who` command</h2></header><div class=entry-content><p>While working on a completely different project, I started to ask myself how the who command was working under the hood. In the end, I thought it was a good topic for a blog post.
Who is who Let’s start with the basics. the who command allows you to list the users currently logged on the system. For example, on my machine:
$ who gauthier tty2 2020-08-30 15:06 (tty2) gauthier pts/1 2020-08-30 15:06 (tmux(1555).%0) gauthier pts/2 2020-08-30 16:41 (tmux(1555).%6) gauthier pts/4 2020-08-30 15:57 (tmux(1555).%3) It tells me that I am logged on the “physical” terminal tty2 and on three pseudo terminals. Indeed my current session of Gnome Shell is running on tty2 and I have 3 tmux windows open.
...</p></div><footer class=entry-footer><span title='2020-08-31 11:40:00 +0000 UTC'>August 31, 2020</span>&nbsp;·&nbsp;1022 words&nbsp;·&nbsp;Gauthier Jolly</footer><a class=entry-link aria-label="post link to The UNIX `who` command" href=https://gjolly.fr/blog/who/></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://gjolly.fr/>Gauthier Jolly</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>